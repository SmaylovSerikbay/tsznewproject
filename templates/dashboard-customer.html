{% load static %}
{% load l10n %}
{% load i18n %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Личный кабинет — Той со звездой</title>
      <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Montserrat', 'system-ui', 'sans-serif'],
          },
          colors: {
            'primary': '#7C3AED',
            'primary-dark': '#5B21B6',
            'accent': '#F59E0B',
            'accent-dark': '#D97706',
          }
        }
      }
    }
  </script>
  
  <!-- Загружаем скрипты в head для раннего доступа к функциям -->
  <script src="{% static 'js/main.js' %}?v=19"></script>
  <script src="{% static 'js/mobile-menu.js' %}?v=20"></script>
  
  <!-- Стили для очень маленьких экранов -->
  <style>
    @media (max-width: 360px) {
      .stats-grid {
        gap: 0.25rem !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
      }
      .stats-card {
        padding: 0.375rem !important;
      }
      .stats-text {
        font-size: 0.625rem !important;
        line-height: 1 !important;
      }
      .nav-grid {
        gap: 0.375rem !important;
      }
      .nav-btn {
        padding: 0.5rem !important;
      }
      .nav-icon {
        font-size: 1rem !important;
        margin-right: 0.25rem !important;
      }
      .nav-text {
        font-size: 0.75rem !important;
      }
      .card-buttons {
        gap: 0.125rem !important;
      }
      .card-btn {
        padding-left: 0.375rem !important;
        padding-right: 0.375rem !important;
        font-size: 0.625rem !important;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b sticky top-0 z-40">
    <div class="container mx-auto px-4">
      <!-- Desktop Header -->
      <div class="hidden md:flex justify-between items-center h-16">
        <div class="text-2xl font-bold text-primary">Той со звездой</div>
        <nav class="flex space-x-8">
          <a href="{% url 'main:index' %}" class="flex items-center space-x-2 text-gray-700 hover:text-primary transition-colors">
          <i class="ri-home-line"></i>
          <span>Главная</span>
        </a>
          <a href="{% url 'main:catalog' %}" class="flex items-center space-x-2 text-gray-700 hover:text-primary transition-colors">
          <i class="ri-group-line"></i>
          <span>Исполнители</span>
        </a>
        {% if user.is_authenticated %}
          {% if user.user_type == 'customer' %}
              <a href="#" onclick="openCreateOrderModal(); return false;" class="flex items-center space-x-2 text-gray-700 hover:text-primary transition-colors">
              <i class="ri-add-circle-line"></i>
              <span>Создать заявку</span>
            </a>
          {% endif %}
            <div class="relative group">
              <button class="flex items-center space-x-2 text-gray-700 hover:text-primary transition-colors" type="button">
                <div class="flex items-center space-x-2">
                {% if user.profile_photo %}
                    <img src="{{ user.profile_photo.url }}" alt="{{ user.get_full_name }}" class="w-8 h-8 rounded-full object-cover">
                {% else %}
                    <i class="ri-user-line text-xl"></i>
                {% endif %}
                  <span class="hidden lg:block">{{ user.get_full_name|default:user.phone_number }}</span>
              </div>
              <i class="ri-arrow-down-s-line"></i>
            </button>
              <div class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200">
                <a href="{% url 'main:dashboard' %}" class="flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                <i class="ri-dashboard-line"></i>
                <span>Личный кабинет</span>
              </a>
                <a href="{% url 'main:logout' %}" class="flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                <i class="ri-logout-box-line"></i>
                <span>Выйти</span>
              </a>
            </div>
          </div>
        {% else %}
            <a href="{% url 'main:auth' %}" class="flex items-center space-x-2 text-gray-700 hover:text-primary transition-colors">
            <i class="ri-login-box-line"></i>
            <span>Войти по номеру телефона</span>
          </a>
        {% endif %}
      </nav>
      </div>

      <!-- Mobile Header -->
      <div class="md:hidden flex justify-between items-center h-14">
        <div class="text-lg font-bold text-primary">Личный кабинет</div>
        <div class="flex items-center space-x-3">
          {% if user.user_type == 'customer' %}
            <button onclick="openCreateOrderModal()" class="p-2 bg-accent text-white rounded-lg">
              <i class="ri-add-line text-lg"></i>
      </button>
          {% endif %}
          <button class="p-2" aria-label="Открыть меню" onclick="toggleMobileMenu()">
            <div class="w-6 h-6 flex flex-col justify-center space-y-1">
              <span class="w-6 h-0.5 bg-gray-600 transition-all"></span>
              <span class="w-6 h-0.5 bg-gray-600 transition-all"></span>
              <span class="w-6 h-0.5 bg-gray-600 transition-all"></span>
            </div>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div id="mobileMenu" class="md:hidden fixed inset-0 z-50 bg-black bg-opacity-50 opacity-0 invisible transition-all duration-300">
    <div class="fixed right-0 top-0 h-full w-80 bg-white shadow-xl transform translate-x-full transition-transform duration-300">
      <div class="p-6">
        <div class="flex justify-between items-center mb-8">
          <div class="text-xl font-bold text-primary">Меню</div>
          <button onclick="toggleMobileMenu()" class="p-2 text-gray-500 hover:text-gray-700">
            <i class="ri-close-line text-xl"></i>
          </button>
        </div>
        <nav class="space-y-4">
          <a href="{% url 'main:index' %}" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
            <i class="ri-home-line text-xl"></i>
          <span>Главная</span>
        </a>
          <a href="{% url 'main:catalog' %}" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
            <i class="ri-user-star-line text-xl"></i>
          <span>Исполнители</span>
        </a>
        {% if user.is_authenticated %}
          {% if user.user_type == 'customer' %}
              <a href="#" onclick="openCreateOrderModal(); return false;" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="ri-add-circle-line text-xl"></i>
              <span>Создать заявку</span>
            </a>
          {% endif %}
            <div class="border-t pt-4 mt-4">
              <div class="flex items-center space-x-3 p-3 mb-4">
                {% if user.profile_photo %}
                  <img src="{{ user.profile_photo.url }}" alt="{{ user.get_full_name }}" class="w-10 h-10 rounded-full object-cover">
                {% else %}
                  <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center">
                    <i class="ri-user-line text-gray-500"></i>
                  </div>
                {% endif %}
                <div>
                  <div class="font-medium text-gray-900">{{ user.get_full_name|default:user.phone_number }}</div>
                  <div class="text-sm text-gray-500">{{ user.phone_number }}</div>
              </div>
              </div>
              <a href="{% url 'main:dashboard' %}" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="ri-dashboard-line text-xl"></i>
                <span>Личный кабинет</span>
              </a>
              <a href="{% url 'main:logout' %}" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                <i class="ri-logout-box-line text-xl"></i>
                <span>Выйти</span>
              </a>
          </div>
        {% else %}
            <a href="{% url 'main:auth' %}" class="flex items-center space-x-3 p-3 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
              <i class="ri-login-box-line text-xl"></i>
            <span>Войти по номеру телефона</span>
          </a>
        {% endif %}
      </nav>
      </div>
    </div>
  </div>

  <main class="min-h-screen pb-8 pt-4 md:pt-8">
    <div class="container mx-auto px-4">
      <div class="space-y-6">
        <!-- Header - Desktop Only -->
        <div class="hidden md:flex justify-between items-center">
          <h1 class="text-3xl font-bold text-gray-900">Личный кабинет заказчика</h1>
          <div class="flex gap-3">
            <button onclick="openCreateOrderModal()" class="inline-flex items-center px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark transition-colors">
              <i class="ri-add-line mr-2"></i>
              Создание заявки
            </button>
          </div>
        </div>



        <!-- Desktop Статистика -->
        <div class="hidden md:block bg-white rounded-xl shadow-sm border p-6">
          <div class="grid grid-cols-5 gap-4">
            <div class="text-center p-4">
              <div class="text-3xl font-bold text-blue-600 mb-1">{{ active_orders_count }}</div>
              <div class="text-sm font-medium text-gray-500">Активные заявки</div>
          </div>
            <div class="text-center p-4">
              <div class="text-3xl font-bold text-green-600 mb-1">{{ completed_orders_count }}</div>
              <div class="text-sm font-medium text-gray-500">Завершенные</div>
          </div>
            <div class="text-center p-4">
              <div class="text-3xl font-bold text-purple-600 mb-1">{{ responses_count }}</div>
              <div class="text-sm font-medium text-gray-500">Отклики</div>
          </div>
            <div class="text-center p-4">
              <div class="text-3xl font-bold text-orange-600 mb-1">{{ bookings_count }}</div>
              <div class="text-sm font-medium text-gray-500">Бронирования</div>
          </div>
            <div class="text-center p-4">
              <div class="text-2xl font-bold text-accent mb-1">{{ total_spent|floatformat:0 }} ₸</div>
              <div class="text-sm font-medium text-gray-500">Потрачено</div>
            </div>
          </div>
        </div>

        <!-- Mobile Статистика - одна строка -->
        <div class="md:hidden">
          <div class="stats-grid grid grid-cols-4 gap-1 px-3">
            <div class="stats-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg p-2 text-white text-center">
              <div class="text-lg font-bold">{{ active_orders_count }}</div>
              <div class="stats-text text-xs opacity-90 leading-tight">Активные</div>
            </div>
            <div class="stats-card bg-gradient-to-br from-green-500 to-green-600 rounded-lg p-2 text-white text-center">
              <div class="text-lg font-bold">{{ completed_orders_count }}</div>
              <div class="stats-text text-xs opacity-90 leading-tight">Готовые</div>
            </div>
            <div class="stats-card bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg p-2 text-white text-center">
              <div class="text-lg font-bold">{{ responses_count }}</div>
              <div class="stats-text text-xs opacity-90 leading-tight">Отклики</div>
            </div>
            <div class="stats-card bg-gradient-to-br from-orange-500 to-orange-600 rounded-lg p-2 text-white text-center">
              <div class="text-lg font-bold">{{ bookings_count }}</div>
              <div class="stats-text text-xs opacity-90 leading-tight">Брони</div>
            </div>
          </div>
        </div>

        <!-- Desktop Tabs -->
        <div class="hidden md:block bg-white rounded-xl shadow-sm border">
          <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6" aria-label="Tabs">
              <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap border-primary text-primary" onclick="showTab('orders', this)">
                <i class="ri-file-list-line mr-2"></i>Мои заявки
          </button>
              <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" onclick="showTab('bookings', this)">
                <i class="ri-calendar-check-line mr-2"></i>Бронирования
          </button>
              <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" onclick="showTab('responses', this)">
                <i class="ri-message-3-line mr-2"></i>Отклики
          </button>
              <button class="tab-button py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" onclick="showTab('profile', this)">
                <i class="ri-user-settings-line mr-2"></i>Профиль
          </button>
            </nav>
        </div>

          <!-- Контент табов для Desktop -->
          <div class="tab-content-wrapper">
            <!-- Desktop контент будет здесь -->
          </div>
        </div>

        <!-- Mobile App-style Content -->
        <div class="md:hidden">
          <!-- Навигация по разделам -->
          <div class="bg-white rounded-xl shadow-sm border mb-4">
            <div class="p-4">
              <h3 class="text-lg font-semibold text-gray-900 mb-4">Разделы</h3>
              <div class="nav-grid grid grid-cols-2 gap-2">
                <button onclick="showTab('orders', this)" class="nav-btn mobile-nav-btn flex items-center p-3 rounded-xl bg-blue-50 text-blue-600 active">
                  <i class="nav-icon ri-file-list-line text-xl mr-2"></i>
                  <div class="text-left min-w-0 flex-1">
                    <div class="nav-text text-sm font-semibold truncate">Заявки</div>
                    <div class="text-xs opacity-75">{{ orders_count }}</div>
                  </div>
                </button>
                <button onclick="showTab('responses', this)" class="nav-btn mobile-nav-btn flex items-center p-3 rounded-xl bg-gray-50 text-gray-500">
                  <i class="nav-icon ri-message-3-line text-xl mr-2"></i>
                  <div class="text-left min-w-0 flex-1">
                    <div class="nav-text text-sm font-semibold truncate">Отклики</div>
                    <div class="text-xs opacity-75">{{ responses_count }}</div>
                  </div>
                </button>
                <button onclick="showTab('bookings', this)" class="nav-btn mobile-nav-btn flex items-center p-3 rounded-xl bg-gray-50 text-gray-500">
                  <i class="nav-icon ri-calendar-check-line text-xl mr-2"></i>
                  <div class="text-left min-w-0 flex-1">
                    <div class="nav-text text-sm font-semibold truncate">Брони</div>
                    <div class="text-xs opacity-75">{{ bookings_count }}</div>
                  </div>
                </button>
                <button onclick="showTab('profile', this)" class="nav-btn mobile-nav-btn flex items-center p-3 rounded-xl bg-gray-50 text-gray-500">
                  <i class="nav-icon ri-user-settings-line text-xl mr-2"></i>
                  <div class="text-left min-w-0 flex-1">
                    <div class="nav-text text-sm font-semibold truncate">Профиль</div>
                    <div class="text-xs opacity-75">Настройки</div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Content Container -->
        <div class="md:bg-white md:rounded-xl md:shadow-sm md:border">

          <!-- Таб Заявки -->
          <div id="orders" class="tab-content p-4 md:p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4 md:mb-6 hidden md:block">Мои заявки ({{ orders_count }})</h3>
            
            <!-- Desktop Table -->
            <div class="hidden md:block overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Название</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Тип</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Бюджет</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                </tr>
              </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                {% for order in orders %}
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ order.title }}</div>
                      <div class="text-sm text-gray-500">{{ order.get_event_type_display }}</div>
                  </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ order.event_date|date:"d.m.Y" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                    {% if order.order_type == 'booking' %}
                        <span class="inline-flex items-center text-sm text-blue-600">
                          <i class="ri-calendar-check-line mr-1"></i> Бронирование
                        </span>
                    {% else %}
                        <span class="inline-flex items-center text-sm text-gray-600">
                          <i class="ri-file-list-line mr-1"></i> Заявка
                        </span>
                    {% endif %}
                  </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      {% if order.status == 'new' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ order.get_status_display }}</span>
                      {% elif order.status == 'in_progress' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ order.get_status_display }}</span>
                      {% elif order.status == 'completed' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ order.get_status_display }}</span>
                      {% elif order.status == 'cancelled' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ order.get_status_display }}</span>
                      {% else %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ order.get_status_display }}</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ order.budget|floatformat:0 }} ₸</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div class="flex gap-2">
                        <button onclick="openOrderDetailModal({{ order.id }},'view')" class="text-indigo-600 hover:text-indigo-900 px-3 py-1 rounded text-xs border border-indigo-600">
                          Подробнее
                        </button>
                        {% if order.status == 'new' %}
                          <button onclick="openEditOrderModal({{ order.id }})" class="text-blue-600 hover:text-blue-900 px-3 py-1 rounded text-xs border border-blue-600">
                            Редактировать
                          </button>
                          <button onclick="cancelOrder({{ order.id }})" class="text-red-600 hover:text-red-900 px-3 py-1 rounded text-xs border border-red-600">
                            Отменить
                          </button>
                        {% elif order.status == 'in_progress' %}
                          <a href="https://wa.me/{{ order.performer.phone_number|default:order.customer.phone_number }}?text=Здравствуйте! У меня есть вопрос по заказу {{ order.title }}" target="_blank" class="text-green-600 hover:text-green-900 px-3 py-1 rounded text-xs border border-green-600">
                            <i class="ri-whatsapp-line mr-1"></i>WhatsApp
                          </a>
                          <button onclick="completeOrder({{ order.id }})" class="text-green-600 hover:text-green-900 px-3 py-1 rounded text-xs border border-green-600">
                            Завершить
                          </button>
                        {% elif order.status == 'completed' and order.performer and order.id not in customer_reviews %}
                          <button onclick="openReviewModal({{ order.id }})" class="text-orange-600 hover:text-orange-900 px-3 py-1 rounded text-xs border border-orange-600">
                            Отзыв
                          </button>
                        {% elif order.status == 'completed' and order.performer and order.id in customer_reviews %}
                          <span class="text-green-600 px-3 py-1 rounded text-xs border border-green-600">Отзыв оставлен</span>
                        {% endif %}
                      </div>
                    </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

            <!-- Mobile Cards - Compact App Style -->
            <div class="md:hidden space-y-3">
              {% for order in orders %}
              <div class="bg-white rounded-2xl p-4 shadow-sm border border-gray-100" onclick="openOrderDetailModal({{ order.id }},'view')">
                <!-- Header Row -->
                <div class="flex items-center justify-between mb-3">
                  <div class="flex items-center space-x-2">
                    {% if order.status == 'new' %}
                      <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                      <span class="text-xs font-medium text-blue-700 bg-blue-50 px-2 py-1 rounded-full">
                        {{ order.get_status_display }}
                      </span>
                    {% elif order.status == 'in_progress' %}
                      <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                      <span class="text-xs font-medium text-yellow-700 bg-yellow-50 px-2 py-1 rounded-full">
                        {{ order.get_status_display }}
                      </span>
                    {% elif order.status == 'completed' %}
                      <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                      <span class="text-xs font-medium text-green-700 bg-green-50 px-2 py-1 rounded-full">
                        {{ order.get_status_display }}
                      </span>
                    {% else %}
                      <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                      <span class="text-xs font-medium text-gray-700 bg-gray-50 px-2 py-1 rounded-full">
                        {{ order.get_status_display }}
                      </span>
                    {% endif %}
                  </div>
                  <div class="text-xs text-gray-500">{{ order.event_date|date:"d.m" }}</div>
                </div>
                
                <!-- Title and Type -->
                <div class="mb-3">
                  <h4 class="text-base font-semibold text-gray-900 mb-1 truncate">{{ order.title }}</h4>
                  <p class="text-sm text-gray-600">{{ order.get_event_type_display }}</p>
                </div>
                
                <!-- Budget and Responses -->
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center text-sm text-gray-600">
                    <i class="ri-price-tag-3-line text-green-500 mr-1 text-base"></i>
                    <span class="font-medium">{{ order.budget|floatformat:0 }} ₸</span>
                  </div>
                  {% if order.responses_count > 0 %}
                    <div class="flex items-center text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded-full">
                      <i class="ri-message-3-line mr-1"></i>
                      {{ order.responses_count }}
                    </div>
                  {% endif %}
                </div>
                
                <!-- Action Buttons -->
                <div class="flex gap-2">
                  <button onclick="event.stopPropagation(); openOrderDetailModal({{ order.id }},'view')" class="flex-1 bg-gray-100 text-gray-700 py-2.5 px-3 rounded-xl text-sm font-medium active:bg-gray-200 transition-colors">
                    Подробнее
                  </button>
                  {% if order.status == 'new' %}
                    <button onclick="event.stopPropagation(); openEditOrderModal({{ order.id }})" class="bg-blue-100 text-blue-700 py-2.5 px-3 rounded-xl text-sm font-medium active:bg-blue-200 transition-colors">
                      <i class="ri-edit-line text-base"></i>
                    </button>
                    <button onclick="event.stopPropagation(); cancelOrder({{ order.id }})" class="bg-red-100 text-red-700 py-2.5 px-3 rounded-xl text-sm font-medium active:bg-red-200 transition-colors">
                      <i class="ri-close-line text-base"></i>
                    </button>
                  {% elif order.status == 'in_progress' %}
                    <a href="https://wa.me/{{ order.performer.phone_number|default:order.customer.phone_number }}?text=Здравствуйте! У меня есть вопрос по заказу {{ order.title }}" target="_blank" class="bg-green-100 text-green-700 py-2.5 px-3 rounded-xl text-sm font-medium active:bg-green-200 transition-colors">
                      <i class="ri-whatsapp-line text-base"></i>
                    </a>
                    <button onclick="event.stopPropagation(); completeOrder({{ order.id }})" class="bg-green-100 text-green-700 py-2.5 px-4 rounded-xl text-sm font-medium active:bg-green-200 transition-colors">
                      <i class="ri-check-line text-base mr-1"></i>Готово
                    </button>
                  {% elif order.status == 'completed' and order.performer and order.id not in customer_reviews %}
                    <button onclick="event.stopPropagation(); openReviewModal({{ order.id }})" class="bg-yellow-100 text-yellow-700 py-2.5 px-4 rounded-xl text-sm font-medium active:bg-yellow-200 transition-colors">
                      <i class="ri-star-line text-base mr-1"></i>Отзыв
                    </button>
                  {% elif order.status == 'completed' and order.performer and order.id in customer_reviews %}
                    <span class="bg-green-100 text-green-700 py-2.5 px-4 rounded-xl text-sm font-medium flex items-center">
                      <i class="ri-check-line text-base mr-1"></i>Готово
                    </span>
                  {% endif %}
                </div>
              </div>
              {% empty %}
              <div class="text-center py-12">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="ri-file-list-line text-gray-400 text-2xl"></i>
                </div>
                <p class="text-gray-500 mb-4">У вас пока нет заявок</p>
                <button onclick="openCreateOrderModal()" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-blue-700 transition-colors">
                  Создать заявку
                </button>
              </div>
              {% endfor %}
          </div>
        </div>

        <!-- Таб Отклики -->
          <div id="responses" class="tab-content p-4 md:p-6 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-6 hidden md:block">Отклики на мои заявки ({{ responses_count }})</h3>
            
            <!-- Desktop Table -->
            <div class="hidden md:block overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Заявка</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Исполнитель</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Цена</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Сообщение</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата отклика</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                </tr>
              </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                {% for response in responses %}
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ response.order.title }}</div>
                      <div class="text-sm text-gray-500">{{ response.order.event_date|date:"d.m.Y" }}</div>
                  </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ response.performer.get_full_name }}</div>
                      <div class="text-sm text-gray-500">{{ response.performer.service_type.name|default:"Не указано" }}</div>
                  </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ response.price }} ₸</td>
                    <td class="px-6 py-4 text-sm text-gray-900">
                      {% if response.message %}
                        <div class="max-w-xs truncate" title="{{ response.message }}">{{ response.message }}</div>
                      {% else %}
                        <span class="text-gray-400">Сообщение не указано</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ response.created_at|date:"d.m.Y" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div class="flex flex-wrap gap-2">
                        <button onclick="openQuickProfileModal({{ response.performer.id }})" class="text-indigo-600 hover:text-indigo-900 px-3 py-1 rounded text-xs border border-indigo-600">Профиль</button>
                        <button onclick="acceptResponse({{ response.id }})" class="text-green-600 hover:text-green-900 px-3 py-1 rounded text-xs border border-green-600">Принять</button>
                        <button onclick="rejectResponse({{ response.id }})" class="text-red-600 hover:text-red-900 px-3 py-1 rounded text-xs border border-red-600">Отклонить</button>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

            <!-- Mobile Cards -->
            <div class="md:hidden space-y-4">
              {% for response in responses %}
              <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-100">
                <div class="flex items-center justify-between mb-4">
                  <div class="flex items-center space-x-3">
                    {% if response.performer.profile_photo %}
                      <img src="{{ response.performer.profile_photo.url }}" alt="{{ response.performer.get_full_name }}" class="w-12 h-12 rounded-full object-cover">
                    {% else %}
                      <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center">
                        <i class="ri-user-line text-gray-600"></i>
                      </div>
                    {% endif %}
                    <div>
                      <h4 class="text-base font-semibold text-gray-900">{{ response.performer.get_full_name }}</h4>
                      <p class="text-sm text-gray-500">{{ response.performer.service_type.name|default:"Исполнитель" }}</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <div class="text-lg font-bold text-green-600">{{ response.price }} ₸</div>
                    <div class="text-xs text-gray-500">{{ response.created_at|date:"d.m.Y" }}</div>
                  </div>
                </div>
                
                <div class="mb-4">
                  <p class="text-sm text-gray-600 mb-1">Заявка: <span class="font-medium text-gray-900">{{ response.order.title }}</span></p>
                  <p class="text-sm text-gray-500">{{ response.order.event_date|date:"d.m.Y" }}</p>
                  {% if response.message %}
                    <div class="mt-2 p-2 bg-gray-50 rounded-lg">
                      <p class="text-sm text-gray-700">{{ response.message }}</p>
                    </div>
                  {% endif %}
                </div>
                
                <div class="flex gap-1 text-xs">
                  <button onclick="openQuickProfileModal({{ response.performer.id }})" class="flex-1 bg-indigo-100 text-indigo-700 py-2 px-3 rounded-xl font-medium">
                    Профиль
                  </button>
                  <button onclick="acceptResponse({{ response.id }})" class="bg-green-100 text-green-700 py-2 px-3 rounded-xl font-medium whitespace-nowrap">
                    <i class="ri-check-line"></i>
                  </button>
                  <button onclick="rejectResponse({{ response.id }})" class="bg-red-100 text-red-700 py-2 px-3 rounded-xl font-medium whitespace-nowrap">
                    <i class="ri-close-line"></i>
                  </button>
                </div>
              </div>
              {% empty %}
              <div class="text-center py-16">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                  <i class="ri-message-3-line text-3xl text-gray-400"></i>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">Нет откликов</h3>
                <p class="text-gray-500 mb-6">Создайте заявку и дождитесь откликов от исполнителей</p>
                <button onclick="openCreateOrderModal()" class="inline-flex items-center px-6 py-3 bg-accent text-white rounded-2xl font-medium shadow-sm">
                  <i class="ri-add-line mr-2"></i>Создать заявку
                </button>
              </div>
              {% endfor %}
          </div>
        </div>

        <!-- Таб Бронирования -->
          <div id="bookings" class="tab-content p-4 md:p-6 hidden">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">Мои бронирования ({{ bookings_count }})</h3>
          
          <!-- Desktop Table View -->
            <div class="hidden md:block overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Исполнитель</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Дата</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Бюджет</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Действия</th>
                </tr>
              </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                {% for booking in bookings %}
                  <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">{{ booking.performer.get_full_name }}</div>
                      <div class="text-sm text-gray-500">{{ booking.performer.service_type.name|default:"Не указано" }}</div>
                  </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.event_date|date:"d.m.Y" }}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      {% if booking.status == 'new' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ booking.get_status_display }}</span>
                      {% elif booking.status == 'in_progress' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ booking.get_status_display }}</span>
                      {% elif booking.status == 'completed' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ booking.get_status_display }}</span>
                      {% elif booking.status == 'cancelled' %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ booking.get_status_display }}</span>
                      {% else %}
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ booking.get_status_display }}</span>
                      {% endif %}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ booking.budget|floatformat:0 }} ₸</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div class="flex gap-2">
                        <button onclick="openOrderDetailModal({{ booking.id }},'view')" class="text-indigo-600 hover:text-indigo-900 px-3 py-1 rounded text-xs border border-indigo-600">
                          Подробнее
                        </button>
                      {% if booking.status == 'in_progress' %}
                          <a href="https://wa.me/{{ booking.performer.phone_number|default:booking.customer.phone_number }}?text=Здравствуйте! У меня есть вопрос по заказу {{ booking.title }}" target="_blank" class="text-green-600 hover:text-green-900 px-3 py-1 rounded text-xs border border-green-600">
                            <i class="ri-whatsapp-line mr-1"></i>WhatsApp
                          </a>
                          <button onclick="completeOrder({{ booking.id }})" class="text-green-600 hover:text-green-900 px-3 py-1 rounded text-xs border border-green-600">
                            Завершить
                          </button>
                          <button onclick="cancelBooking({{ booking.id }})" class="text-red-600 hover:text-red-900 px-3 py-1 rounded text-xs border border-red-600">
                            Отменить бронирование
                          </button>
                      {% elif booking.status == 'new' %}
                          <button onclick="cancelBooking({{ booking.id }})" class="text-red-600 hover:text-red-900 px-3 py-1 rounded text-xs border border-red-600">
                            Отменить бронирование
                          </button>
                      {% elif booking.status == 'cancelled' %}
                          <span class="text-red-600 px-3 py-1 rounded text-xs border border-red-600">Отклонено</span>
                      {% endif %}
                      </div>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5" class="px-6 py-12 text-center">
                      <div class="text-gray-400">
                        <i class="ri-calendar-check-line text-4xl mb-4 block"></i>
                        <p class="text-lg mb-4">У вас пока нет забронированных исполнителей</p>
                        <a href="{% url 'main:catalog' %}" class="inline-flex items-center px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark transition-colors">
                          Найти исполнителя
                        </a>
                      </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Mobile Card View -->
            <div class="md:hidden space-y-4">
            {% for booking in bookings %}
              <div class="bg-white border rounded-lg p-4 shadow-sm">
                <div class="flex justify-between items-start mb-3">
                  <div>
                    <div class="font-medium text-gray-900">{{ booking.performer.get_full_name }}</div>
                    <div class="text-sm text-gray-500">{{ booking.performer.service_type.name|default:"Не указано" }}</div>
                </div>
                  {% if booking.status == 'new' %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ booking.get_status_display }}</span>
                  {% elif booking.status == 'in_progress' %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800">{{ booking.get_status_display }}</span>
                  {% elif booking.status == 'completed' %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">{{ booking.get_status_display }}</span>
                  {% elif booking.status == 'cancelled' %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">{{ booking.get_status_display }}</span>
                  {% else %}
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-gray-100 text-gray-800">{{ booking.get_status_display }}</span>
                  {% endif %}
              </div>
                <div class="space-y-2 mb-4">
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-500">Дата:</span>
                    <span class="text-sm text-gray-900">{{ booking.event_date|date:"d.m.Y" }}</span>
                </div>
                  <div class="flex justify-between">
                    <span class="text-sm text-gray-500">Бюджет:</span>
                    <span class="text-sm text-gray-900">{{ booking.budget|floatformat:0 }} ₸</span>
                </div>
              </div>
                <div class="flex gap-2">
                  <button onclick="openOrderDetailModal({{ booking.id }},'view')" class="bg-indigo-100 text-indigo-700 py-2 px-3 rounded-xl text-sm font-medium active:bg-indigo-200 transition-colors">
                    <i class="ri-eye-line mr-1"></i>Подробнее
                  </button>
                {% if booking.status == 'in_progress' %}
                    <a href="https://wa.me/{{ booking.performer.phone_number|default:booking.customer.phone_number }}?text=Здравствуйте! У меня есть вопрос по заказу {{ booking.title }}" target="_blank" class="bg-green-100 text-green-700 py-2 px-3 rounded-xl text-sm font-medium active:bg-green-200 transition-colors">
                      <i class="ri-whatsapp-line mr-1"></i>WhatsApp
                    </a>
                    <button onclick="completeOrder({{ booking.id }})" class="bg-green-100 text-green-700 py-2 px-3 rounded-xl text-sm font-medium active:bg-green-200 transition-colors">
                      <i class="ri-check-line mr-1"></i>Завершить
                    </button>
                    <button onclick="cancelBooking({{ booking.id }})" class="bg-red-100 text-red-700 py-2 px-3 rounded-xl text-sm font-medium active:bg-red-200 transition-colors">
                      <i class="ri-close-line mr-1"></i>Отменить
                    </button>
                {% elif booking.status == 'new' %}
                    <button onclick="cancelBooking({{ booking.id }})" class="bg-red-100 text-red-700 py-2 px-3 rounded-xl text-sm font-medium active:bg-red-200 transition-colors">
                      <i class="ri-close-line mr-1"></i>Отменить
                    </button>
                {% elif booking.status == 'cancelled' %}
                    <span class="bg-red-100 text-red-700 py-2 px-3 rounded-xl text-sm font-medium">Отклонено</span>
                {% endif %}
                </div>
              </div>
            {% empty %}
              <div class="text-center py-12">
                <div class="text-gray-400">
                  <i class="ri-calendar-check-line text-4xl mb-4 block"></i>
                  <p class="text-lg mb-4">У вас пока нет забронированных исполнителей</p>
                  <a href="{% url 'main:catalog' %}" class="inline-flex items-center px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-dark transition-colors">
                    Найти исполнителя
                  </a>
                </div>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Таб Профиль -->
          <div id="profile" class="tab-content p-4 md:p-6 hidden">
            <div class="space-y-6">
              <!-- Кнопка настроек -->
              <div class="mb-4">
                <a href="{% url 'main:profile_settings' %}" class="w-full inline-flex items-center justify-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                  <i class="ri-settings-line mr-2"></i>
                  Настройки профиля
                </a>
              </div>

              <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6">
                <div class="flex-shrink-0">
              {% if user.profile_photo %}
                    <img src="{{ user.profile_photo.url }}" alt="{{ user.get_full_name }}" class="w-32 h-32 rounded-full object-cover">
              {% else %}
                    <div class="w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center">
                      <i class="ri-user-line text-4xl text-gray-500"></i>
                </div>
              {% endif %}
              </div>
                <div class="text-center sm:text-left">
                  <h2 class="text-2xl font-bold text-gray-900">{{ user.get_full_name|default:"Не указано" }}</h2>
                  <p class="text-gray-600 mt-1">{{ user.phone_number }}</p>
                  <p class="text-gray-600">{{ user.email|default:"Email не указан" }}</p>
            </div>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Город</label>
                                                <span class="text-gray-900">{{ user.city.name|default:"Не указан" if user.city else "Не указан" }}</span>
              </div>
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Дата регистрации</label>
                    <span class="text-gray-900">{{ user.date_joined|date:"d.m.Y" }}</span>
              </div>
              </div>
                <div class="space-y-4">
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Последний вход</label>
                    <span class="text-gray-900">{{ user.last_login|date:"d.m.Y H:i"|default:"Не указано" }}</span>
                  </div>
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-gray-700 mb-1">О себе</label>
                    <span class="text-gray-900">{{ user.bio|default:"Информация не указана" }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Floating Action Button - только на мобильных -->
  {% if user.user_type == 'customer' %}
  <div class="md:hidden fixed bottom-6 right-6 z-50">
    <button onclick="openCreateOrderModal()" class="w-14 h-14 bg-accent text-white rounded-full shadow-lg hover:bg-accent-dark transition-all duration-200 flex items-center justify-center">
      <i class="ri-add-line text-xl"></i>
    </button>
  </div>
  {% endif %}

  <!-- Модальные окна -->
  {% include "modals/order_detail_modal.html" %}
  {% include "modals/quick_profile_modal.html" %}
  {% include "modals/chat_modal.html" %}
  {% include "modals/create_order_modal.html" %}

  <!-- Модальное окно для отзывов -->
  <div id="reviewModal" class="fixed inset-0 z-50 overflow-y-auto hidden">
    <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" onclick="closeReviewModal()"></div>
      
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
      
      <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-medium text-gray-900">Оставить отзыв</h3>
            <button onclick="closeReviewModal()" class="text-gray-400 hover:text-gray-600">
              <i class="ri-close-line text-xl"></i>
            </button>
      </div>
          
          <form id="reviewForm" onsubmit="submitReview(event)" class="space-y-4">
        <input type="hidden" id="reviewOrderId" name="order_id">
        
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Оценка</label>
              <div class="flex space-x-1">
                <input type="radio" name="rating" value="5" id="star5" class="hidden">
                <label for="star5" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                  <i class="ri-star-fill"></i>
                </label>
                <input type="radio" name="rating" value="4" id="star4" class="hidden">
                <label for="star4" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                  <i class="ri-star-fill"></i>
                </label>
                <input type="radio" name="rating" value="3" id="star3" class="hidden">
                <label for="star3" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                  <i class="ri-star-fill"></i>
                </label>
                <input type="radio" name="rating" value="2" id="star2" class="hidden">
                <label for="star2" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                  <i class="ri-star-fill"></i>
                </label>
                <input type="radio" name="rating" value="1" id="star1" class="hidden">
                <label for="star1" class="cursor-pointer text-2xl text-gray-300 hover:text-yellow-400 transition-colors">
                  <i class="ri-star-fill"></i>
                </label>
          </div>
        </div>
        
            <div>
              <label for="reviewComment" class="block text-sm font-medium text-gray-700 mb-2">Комментарий</label>
              <textarea name="comment" id="reviewComment" rows="4" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary" 
                        placeholder="Расскажите о своем опыте работы с исполнителем..." required></textarea>
            </div>
          </form>
        </div>
        
        <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
          <button type="submit" form="reviewForm" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-accent text-base font-medium text-white hover:bg-accent-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent sm:ml-3 sm:w-auto sm:text-sm">
            Отправить отзыв
          </button>
          <button type="button" onclick="closeReviewModal()" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
            Отмена
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-3 md:py-12">
      <!-- Mobile компактная версия -->
      <div class="md:hidden text-center space-y-2">
        <div class="flex justify-center space-x-4">
          <a href="https://www.instagram.com/_miras_event_/" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
            <i class="ri-instagram-line text-lg"></i>
          </a>
          <a href="https://www.tiktok.com/@miras_abildin_?_t=ZM-8yOktSAtIhi&_r=1" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
            <i class="ri-tiktok-line text-lg"></i>
          </a>
          <a href="https://wa.me/77754184629" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
            <i class="ri-whatsapp-line text-lg"></i>
          </a>  
        </div>
        <p class="text-xs text-gray-400">© 2024 Той со звездой</p>
        </div>

      <!-- Desktop полная версия -->
      <div class="hidden md:block">
        <div class="grid grid-cols-3 gap-8">
          <div>
            <h3 class="text-lg font-semibold mb-4">О нас</h3>
            <p class="text-gray-300">Той со звездой - платформа для поиска профессиональных исполнителей для вашего мероприятия.</p>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-4">Контакты</h3>
            <p class="text-gray-300">Email: <a href="mailto:miras.abildin@bk.ru" class="text-accent hover:text-accent-dark">miras.abildin@bk.ru</a></p>
            <p class="text-gray-300">Телефон: <a href="tel:+77754184629" class="text-accent hover:text-accent-dark">+7 (775)-418-46-29</a></p>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-4">Соцсети</h3>
            <div class="flex space-x-4">
              <a href="https://www.instagram.com/_miras_event_/" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
                <i class="ri-instagram-line text-2xl"></i>
              </a>
              <a href="https://www.tiktok.com/@miras_abildin_?_t=ZM-8yOktSAtIhi&_r=1" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
                <i class="ri-tiktok-line text-2xl"></i>
              </a>
              <a href="https://wa.me/77754184629" target="_blank" class="text-gray-300 hover:text-accent transition-colors">
                <i class="ri-whatsapp-line text-2xl"></i>
            </a>  
          </div>
        </div>
      </div>
        <div class="border-t border-gray-800 mt-8 pt-8 text-center">
          <p class="text-gray-400">© 2024 Той со звездой. Все права защищены.</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="{% static 'js/main.js' %}"></script>
  <script>
    /* Мобильное меню JavaScript перенесен в mobile-menu.js */
    
    // Инициализация при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
      // Закрываем все модальные окна при загрузке
      const modals = ['createOrderModal', 'orderDetailModal', 'quickProfileModal', 'reviewModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (modal) {
          modal.classList.add('hidden');
        }
      });
      
      // Инициализация табов
      const firstTab = document.querySelector('.tab-button');
      const firstTabContent = document.getElementById('orders');
      if (firstTab && firstTabContent) {
        firstTabContent.classList.remove('hidden');
      }
    });

    // Функции для табов
    function showTab(tabName, element) {
      // Скрываем все табы
      const tabContents = document.querySelectorAll('.tab-content');
      tabContents.forEach(content => content.classList.add('hidden'));
      
      // Убираем активный класс со всех кнопок (Desktop)
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.classList.remove('border-primary', 'text-primary');
        button.classList.add('border-transparent', 'text-gray-500');
      });
      
      // Убираем активный класс с мобильных кнопок
      const mobileNavButtons = document.querySelectorAll('.mobile-nav-btn');
      mobileNavButtons.forEach(button => {
        button.classList.remove('bg-blue-50', 'text-blue-600', 'active');
        button.classList.add('bg-gray-50', 'text-gray-500');
      });
      
      // Показываем нужный таб
      document.getElementById(tabName).classList.remove('hidden');
      
      // Добавляем активный класс к кнопке
      if (element) {
        // Desktop styles
        if (element.classList.contains('tab-button')) {
          element.classList.remove('border-transparent', 'text-gray-500');
          element.classList.add('border-primary', 'text-primary');
        }
        
        // Mobile styles
        if (element.classList.contains('mobile-nav-btn')) {
          element.classList.remove('bg-gray-50', 'text-gray-500');
          element.classList.add('bg-blue-50', 'text-blue-600', 'active');
        }
      }
    }

    // Функция для показа действий с заказом на мобильных
    function showOrderActions(orderId) {
      // Можно добавить всплывающее меню с действиями
      // Пока просто открываем детали заказа
      openOrderDetailModal(orderId, 'view');
    }

    // Функция для переключения мобильного меню
    function toggleMobileMenu() {
      console.log('toggleMobileMenu called');
      const mobileMenu = document.getElementById('mobileMenu');
      console.log('mobileMenu element:', mobileMenu);
      
      if (!mobileMenu) {
        console.error('Mobile menu not found');
        return;
      }
      
      const menuPanel = mobileMenu.children[0];
      console.log('menuPanel element:', menuPanel);
      
      if (!menuPanel) {
        console.error('Menu panel not found');
        return;
      }
      
      const isHidden = mobileMenu.classList.contains('opacity-0') || mobileMenu.classList.contains('invisible');
      console.log('Menu is hidden:', isHidden);
      
      if (isHidden) {
        // Открываем меню
        mobileMenu.classList.remove('opacity-0', 'invisible');
        mobileMenu.classList.add('opacity-100', 'visible');
        menuPanel.classList.remove('translate-x-full');
        menuPanel.classList.add('translate-x-0');
        console.log('Menu opened');
      } else {
        // Закрываем меню
        mobileMenu.classList.remove('opacity-100', 'visible');
        mobileMenu.classList.add('opacity-0', 'invisible');
        menuPanel.classList.remove('translate-x-0');
        menuPanel.classList.add('translate-x-full');
        console.log('Menu closed');
      }
    }
    
    // Делаем функцию глобально доступной
    window.toggleMobileMenu = toggleMobileMenu;

    // Функция принятия отклика
    function acceptResponse(responseId) {
      if (confirm('Вы уверены, что хотите принять этот отклик?')) {
        fetch(`/order/response/${responseId}/accept/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            showNotification(data.message || 'Отклик успешно принят!', 'success');
            setTimeout(() => { location.reload(); }, 1000);
          } else {
            showNotification('Ошибка при принятии отклика: ' + (data.error || 'Неизвестная ошибка'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('Ошибка при принятии отклика: ' + error.message, 'error');
        });
      }
    }

    // Функция отклонения отклика
    function rejectResponse(responseId) {
      if (confirm('Вы уверены, что хотите отклонить этот отклик?')) {
        fetch(`/order/response/${responseId}/reject/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': getCookie('csrftoken')
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            showNotification(data.message || 'Отклик отклонен', 'success');
            setTimeout(() => { location.reload(); }, 1000);
          } else {
            showNotification('Ошибка при отклонении отклика: ' + (data.error || 'Неизвестная ошибка'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('Ошибка при отклонении отклика: ' + error.message, 'error');
        });
      }
    }

    // Функция отмены заказа
    function cancelOrder(orderId) {
      if (confirm('Вы уверены, что хотите отменить этот заказ?')) {
        fetch(`/order/${orderId}/cancel-api/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            showNotification(data.message || 'Заказ успешно отменен', 'success');
            setTimeout(() => { location.reload(); }, 1000);
          } else {
            showNotification('Ошибка при отмене заказа: ' + (data.error || 'Неизвестная ошибка'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('Ошибка при отмене заказа: ' + error.message, 'error');
        });
      }
    }

    // Функция отмены бронирования
    function cancelBooking(orderId) {
      if (confirm('Вы уверены, что хотите отменить это бронирование?')) {
        fetch(`/order/${orderId}/customer-cancel-booking-api/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            showNotification(data.message || 'Бронирование успешно отменено', 'success');
            setTimeout(() => { location.reload(); }, 1000);
          } else {
            showNotification('Ошибка при отмене бронирования: ' + (data.error || 'Неизвестная ошибка'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('Ошибка при отмене бронирования: ' + error.message, 'error');
        });
      }
    }

    // Функция для получения CSRF токена
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    // Функция уведомлений
    function showNotification(message, type = 'info') {
      // Создаем элемент уведомления
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        animation: slideIn 0.3s ease;
      `;
      
      if (type === 'success') {
        notification.style.background = '#28a745';
      } else if (type === 'error') {
        notification.style.background = '#dc3545';
      } else {
        notification.style.background = '#17a2b8';
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Удаляем через 3 секунды
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }



    // Функции для работы с отзывами
    function openReviewModal(orderId) {
      document.getElementById('reviewOrderId').value = orderId;
      document.getElementById('reviewModal').classList.remove('hidden');
    }

    function closeReviewModal() {
      document.getElementById('reviewModal').classList.add('hidden');
      document.getElementById('reviewForm').reset();
    }

    function submitReview(event) {
      event.preventDefault();
      
      const orderId = document.getElementById('reviewOrderId').value;
      const rating = document.querySelector('input[name="rating"]:checked');
      const comment = document.getElementById('reviewComment').value.trim();
      
      if (!rating) {
        showNotification('Пожалуйста, выберите оценку', 'error');
        return;
      }
      
      if (!comment) {
        showNotification('Пожалуйста, напишите комментарий', 'error');
        return;
      }
      
      const formData = new FormData();
      formData.append('rating', rating.value);
      formData.append('comment', comment);
      
      fetch(`/order/${orderId}/review-api/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken')
        },
        body: formData
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        if (data.success) {
          showNotification(data.message || 'Отзыв успешно добавлен', 'success');
          closeReviewModal();
          setTimeout(() => { location.reload(); }, 1000);
        } else {
          showNotification('Ошибка при добавлении отзыва: ' + (data.error || 'Неизвестная ошибка'), 'error');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        showNotification('Ошибка при добавлении отзыва: ' + error.message, 'error');
      });
    }



    // Функция завершения заказа заказчиком
    function completeOrder(orderId) {
      if (confirm('Вы уверены, что хотите завершить этот заказ?')) {
        fetch(`/order/${orderId}/complete-api/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
          }
        })
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            showNotification(data.message || 'Заказ успешно завершен', 'success');
            setTimeout(() => { location.reload(); }, 1000);
          } else {
            showNotification('Ошибка при завершении заказа: ' + (data.error || 'Неизвестная ошибка'), 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          showNotification('Ошибка при завершении заказа: ' + error.message, 'error');
        });
      }
    }



    // Функции для работы с модальными окнами
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        // Для Tailwind модальных окон (используют hidden класс)
        if (modal.classList.contains('fixed')) {
          modal.classList.remove('hidden');
        } else {
          // Для обычных модальных окон (используют display: block)
          modal.style.display = 'block';
        }
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        // Для Tailwind модальных окон (используют hidden класс)
        if (modal.classList.contains('fixed')) {
          modal.classList.add('hidden');
        } else {
          // Для обычных модальных окон (используют display: none)
          modal.style.display = 'none';
        }
      }
    }

    // Функция открытия модального окна для создания заказа
    function openCreateOrderModal() {
      console.log('openCreateOrderModal called');
      const modal = document.getElementById('createOrderModal');
      if (modal) {
        modal.classList.remove('hidden');
        // Сбрасываем форму если она существует
        const form = document.getElementById('createOrderForm');
        if (form) {
          form.reset();
        }
        
        // Установить минимальную дату (сегодня) если элемент существует
        const eventDateElement = document.getElementById('eventDate');
        if (eventDateElement) {
          const today = new Date().toISOString().split('T')[0];
          eventDateElement.min = today;
        }
      }
    }

    // Функция закрытия модального окна создания заказа
    function closeCreateOrderModal() {
      const modal = document.getElementById('createOrderModal');
      if (modal) {
        modal.classList.add('hidden');
        // Сбрасываем форму если она существует
        const form = document.getElementById('createOrderForm');
        if (form) {
          form.reset();
        }
      }
    }

    // Функция открытия модального окна для редактирования заказа
    function openEditOrderModal(orderId) {
      console.log('Opening edit modal for order:', orderId);
      // Загружаем данные заказа
      fetch(`/order/${orderId}/detail/`)
        .then(response => {
          console.log('Response status:', response.status);
          return response.json();
        })
        .then(data => {
          console.log('Response data:', data);
          if (data.success) {
            const order = data.order;
            
            // Заполняем форму данными
            document.getElementById('orderTitle').value = order.title;
            document.getElementById('eventType').value = order.event_type;
            document.getElementById('eventDate').value = order.event_date ? order.event_date.split('.').reverse().join('-') : '';
            document.getElementById('orderCity').value = order.city || '';
            document.getElementById('venue').value = order.venue || '';
            document.getElementById('guestCount').value = order.guest_count;
            document.getElementById('budget').value = order.budget;
            document.getElementById('description').value = order.description || '';
            
            // Выбираем услуги
            document.querySelectorAll('.service-card').forEach(card => {
              card.classList.remove('selected');
            });
            if (order.services && order.services.length > 0) {
              order.services.forEach(service => {
                const card = document.querySelector(`[data-service="${service}"]`);
                if (card) {
                  card.classList.add('selected');
                }
              });
              document.getElementById('selectedServices').value = JSON.stringify(order.services);
            }
            
            // Меняем заголовок и кнопку
            const modalTitle = document.querySelector('#createOrderModal h3');
            const modalSubtitle = document.querySelector('#createOrderModal p');
            if (modalTitle) {
              modalTitle.innerHTML = '<div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3"><i class="ri-edit-line text-white text-lg"></i></div>Редактировать заявку';
            }
            if (modalSubtitle) {
              modalSubtitle.textContent = 'Измените информацию о вашем мероприятии';
            }
            document.getElementById('submitOrderBtn').innerHTML = '<i class="ri-check-line"></i> Сохранить изменения';
            document.getElementById('createOrderForm').onsubmit = (e) => submitEditOrder(e, orderId);
            
            // Показываем модальное окно
            document.getElementById('createOrderModal').classList.remove('hidden');
          } else {
            showNotification('Ошибка при загрузке данных заказа', 'error');
          }
        })
        .catch(error => {
          console.error('Error loading order data:', error);
          showNotification('Ошибка при загрузке данных заказа: ' + error.message, 'error');
        });
    }

    // Функция для отправки отредактированного заказа
    function submitEditOrder(event, orderId) {
      event.preventDefault();
      
      const submitButton = event.target.querySelector('button[type="submit"]');
      const originalText = submitButton.innerHTML;
      submitButton.innerHTML = '<i class="ri-loader-4-line mr-2 animate-spin"></i>Сохраняем...';
      submitButton.disabled = true;
      
      const formData = new FormData(event.target);
      
      // Добавить выбранные услуги
      const selectedServices = Array.from(document.querySelectorAll('input[name="services"]:checked')).map(cb => cb.value);
      formData.set('services', JSON.stringify(selectedServices));
      
      fetch(`/order/${orderId}/edit/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          closeCreateOrderModal();
          showNotification('Заказ успешно обновлен!', 'success');
          setTimeout(() => location.reload(), 1500);
        } else {
          showNotification(data.message || 'Ошибка при обновлении заказа', 'error');
          }
        })
        .catch(error => {
          console.error('Error:', error);
        showNotification('Произошла ошибка при обновлении заказа', 'error');
      })
      .finally(() => {
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
      });
    }

    // Функция для закрытия модальных окон
    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('hidden');
      }
      

    }

    // Закрытие модального окна для создания заказа при клике вне его
    window.onclick = function(event) {
      const createOrderModal = document.getElementById('createOrderModal');
      const reviewModal = document.getElementById('reviewModal');
      if (event.target === createOrderModal) {
        createOrderModal.classList.add('hidden');
      }
      if (event.target === reviewModal) {
        closeReviewModal();
      }
    }

    // Автоматическое открытие модального окна при переходе по ссылке с хешем #create-order
    document.addEventListener('DOMContentLoaded', function() {
      if (window.location.hash === '#create-order') {
        // Небольшая задержка для полной загрузки страницы
        setTimeout(() => {
          openCreateOrderModal();
          // Убираем хеш из URL
          history.replaceState(null, null, window.location.pathname);
        }, 100);
      }
    });
  </script>

  <!-- Модальное окно для редактирования заказа -->
  {% include 'modals/edit_order_modal.html' %}

</body>
</html> 