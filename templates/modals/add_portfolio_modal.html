<!-- Add Portfolio Modal -->
<div id="addPortfolioModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
    <div class="flex justify-between items-center p-6 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Добавить в портфолио</h2>
      <button class="text-gray-400 hover:text-gray-600 transition-colors" onclick="closeModal('addPortfolioModal')">
        <i class="ri-close-line text-2xl"></i>
      </button>
    </div>
    
    <form id="portfolioForm" action="{% url 'main:add_portfolio' %}" method="POST" enctype="multipart/form-data" class="p-6">
      {% csrf_token %}
      
      <!-- Media Type Selection -->
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-3">Тип медиа:</label>
        <div class="flex space-x-4">
          <label class="flex items-center">
            <input type="radio" name="media_type" value="image" checked class="mr-2 text-blue-600 focus:ring-blue-500" onchange="toggleMediaType()">
            <span class="text-sm text-gray-700">Фото</span>
          </label>
          <label class="flex items-center">
            <input type="radio" name="media_type" value="video" class="mr-2 text-blue-600 focus:ring-blue-500" onchange="toggleMediaType()">
            <span class="text-sm text-gray-700">Видео</span>
          </label>
        </div>
      </div>

      <!-- Title and Description -->
      <div class="mb-6">
        <div class="mb-4">
          <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Название работы</label>
          <input type="text" id="title" name="title" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Введите название работы">
        </div>
        <div>
          <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Описание</label>
          <textarea id="description" name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Описание работы (необязательно)"></textarea>
        </div>
      </div>

      <!-- File Upload -->
      <div id="dropzone" class="border-2 border-dashed border-blue-200 rounded-lg p-8 text-center cursor-pointer transition-all duration-200 bg-blue-50 hover:bg-blue-100" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
        <i class="ri-upload-cloud-2-line text-4xl text-blue-500 mb-4"></i>
        <p id="dropzoneText" class="text-gray-700">Перетащите файл сюда или <span class="text-blue-500 underline cursor-pointer" onclick="document.getElementById('portfolioUpload').click()">выберите файл</span></p>
        <p id="fileTypes" class="text-sm text-gray-500 mt-2">Поддерживаемые форматы: JPG, PNG, GIF</p>
        <input type="file" id="portfolioUpload" name="image" accept="image/*" class="hidden" onchange="handleFileSelect(event)">
        <div id="preview" class="mt-4"></div>
      </div>
      
      <div class="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200">
        <button type="button" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors" onclick="closeModal('addPortfolioModal')">
          Отмена
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          Загрузить
        </button>
      </div>
    </form>
  </div>
</div>

<script>
function toggleMediaType() {
  const imageRadio = document.querySelector('input[value="image"]');
  const videoRadio = document.querySelector('input[value="video"]');
  const dropzone = document.getElementById('dropzone');
  const dropzoneText = document.getElementById('dropzoneText');
  const fileTypes = document.getElementById('fileTypes');
  const fileInput = document.getElementById('portfolioUpload');
  
  if (imageRadio.checked) {
    dropzone.className = 'border-2 border-dashed border-blue-200 rounded-lg p-8 text-center cursor-pointer transition-all duration-200 bg-blue-50 hover:bg-blue-100';
    dropzoneText.innerHTML = 'Перетащите фото сюда или <span class="text-blue-500 underline cursor-pointer" onclick="document.getElementById(\'portfolioUpload\').click()">выберите файл</span>';
    fileTypes.textContent = 'Поддерживаемые форматы: JPG, PNG, GIF';
    fileInput.accept = 'image/*';
    fileInput.name = 'image';
  } else {
    dropzone.className = 'border-2 border-dashed border-green-200 rounded-lg p-8 text-center cursor-pointer transition-all duration-200 bg-green-50 hover:bg-green-100';
    dropzoneText.innerHTML = 'Перетащите видео сюда или <span class="text-green-500 underline cursor-pointer" onclick="document.getElementById(\'portfolioUpload\').click()">выберите файл</span>';
    fileTypes.textContent = 'Поддерживаемые форматы: MP4, AVI, MOV';
    fileInput.accept = 'video/*';
    fileInput.name = 'video';
  }
}

function handleDrop(e) {
  e.preventDefault();
  const files = e.dataTransfer.files;
  if (files.length > 0) {
    handleFile(files[0]);
  }
}

function handleDragOver(e) {
  e.preventDefault();
  const dropzone = document.getElementById('dropzone');
  dropzone.classList.add('border-blue-400', 'bg-blue-100');
}

function handleDragLeave(e) {
  e.preventDefault();
  const dropzone = document.getElementById('dropzone');
  dropzone.classList.remove('border-blue-400', 'bg-blue-100');
}

function handleFileSelect(e) {
  const file = e.target.files[0];
  if (file) {
    handleFile(file);
  }
}

function handleFile(file) {
  const imageRadio = document.querySelector('input[value="image"]');
  const preview = document.getElementById('preview');
  
  // Очищаем предыдущий превью
  preview.innerHTML = '';
  
  if (imageRadio.checked) {
    // Показываем превью изображения
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `
          <div class="relative inline-block">
            <img src="${e.target.result}" alt="Preview" class="max-w-full h-auto max-h-48 rounded-lg shadow-md">
            <button type="button" onclick="removeFile()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-colors">
              <i class="ri-close-line text-sm"></i>
            </button>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    }
  } else {
    // Показываем превью видео
    if (file.type.startsWith('video/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `
          <div class="relative inline-block">
            <video src="${e.target.result}" controls class="max-w-full h-auto max-h-48 rounded-lg shadow-md"></video>
            <button type="button" onclick="removeFile()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition-colors">
              <i class="ri-close-line text-sm"></i>
            </button>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    }
  }
}

function removeFile() {
  document.getElementById('preview').innerHTML = '';
  document.getElementById('portfolioUpload').value = '';
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  modal.classList.add('hidden');
  // Сброс формы
  document.getElementById('portfolioForm').reset();
  document.getElementById('preview').innerHTML = '';
}
</script> 