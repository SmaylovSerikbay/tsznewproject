# Уведомления для бронирования исполнителей

## Обзор

Реализована система уведомлений через WhatsApp для всех операций с бронированием исполнителей, аналогично существующей системе уведомлений для откликов на заявки.

## Реализованные уведомления

### 1. Новое бронирование
**Метод:** `send_new_booking_notification(order)`
**Когда отправляется:** При создании нового бронирования исполнителя
**Получатель:** Исполнитель
**Содержание:**
- Информация о заказчике
- Детали заказа (дата, бюджет, город)
- Ссылка на принятие/отклонение бронирования

### 2. Принятие бронирования
**Метод:** `send_booking_accepted_notification(order)`
**Когда отправляется:** Когда исполнитель принимает бронирование
**Получатель:** Заказчик
**Содержание:**
- Подтверждение принятия бронирования
- Информация об исполнителе
- Статус "Бронирование подтверждено"

### 3. Отклонение бронирования
**Метод:** `send_booking_rejected_notification(order)`
**Когда отправляется:** Когда исполнитель отклоняет бронирование
**Получатель:** Заказчик
**Содержание:**
- Уведомление об отклонении
- Рекомендация найти других исполнителей

### 4. Отмена бронирования исполнителем
**Метод:** `send_booking_cancelled_by_performer_notification(order)`
**Когда отправляется:** Когда исполнитель отменяет уже принятое бронирование
**Получатель:** Заказчик
**Содержание:**
- Уведомление об отмене
- Рекомендация найти других исполнителей

### 5. Отмена бронирования заказчиком
**Метод:** `send_booking_cancelled_by_customer_notification(order)`
**Когда отправляется:** Когда заказчик отменяет бронирование
**Получатель:** Исполнитель
**Содержание:**
- Уведомление об отмене
- Рекомендация найти другие заявки

## Интеграция в код

### Файлы изменены:

1. **`main/notifications.py`**
   - Добавлены новые методы уведомлений для бронирования
   - Все методы следуют единому стилю форматирования сообщений

2. **`main/views.py`**
   - Добавлен импорт `WhatsAppNotificationService`
   - Интегрированы уведомления в функции:
     - `create_order_booking()` - уведомление о новом бронировании
     - `accept_booking_api()` - уведомление о принятии
     - `reject_booking_api()` - уведомление об отклонении
     - `performer_cancel_booking_api()` - уведомление об отмене исполнителем
     - `customer_cancel_booking_api()` - уведомление об отмене заказчиком

## Тестирование

Создан тестовый скрипт `test_booking_notifications.py` для проверки всех типов уведомлений.

### Запуск тестов:
```bash
python test_booking_notifications.py
```

## Формат сообщений

Все уведомления используют единый стиль:
- Эмодзи для визуального выделения
- Структурированная информация
- Ссылки на соответствующие страницы
- Дружелюбный тон

## Логика работы

1. **Создание бронирования:**
   - Заказчик создает бронирование → уведомление исполнителю

2. **Принятие/отклонение:**
   - Исполнитель принимает → уведомление заказчику
   - Исполнитель отклоняет → уведомление заказчику

3. **Отмена:**
   - Исполнитель отменяет → уведомление заказчику
   - Заказчик отменяет → уведомление исполнителю

## Безопасность

- Уведомления отправляются только пользователям с подтвержденными номерами телефонов
- Проверка прав доступа перед отправкой
- Обработка ошибок при отправке

## Совместимость

Система полностью совместима с существующими уведомлениями для откликов и использует тот же сервис WhatsApp API.
